<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>13.1 API Handling, Server Actions, and Context API | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/W2024/assets/css/0.styles.38548c21.css" as="style"><link rel="preload" href="/W2024/assets/js/app.75ab4a46.js" as="script"><link rel="preload" href="/W2024/assets/js/2.169fe304.js" as="script"><link rel="preload" href="/W2024/assets/js/46.51e42aff.js" as="script"><link rel="preload" href="/W2024/assets/js/9.83ac2bbe.js" as="script"><link rel="preload" href="/W2024/assets/js/11.5fe5a40b.js" as="script"><link rel="prefetch" href="/W2024/assets/js/10.bb55a56f.js"><link rel="prefetch" href="/W2024/assets/js/12.cb875653.js"><link rel="prefetch" href="/W2024/assets/js/13.1700d232.js"><link rel="prefetch" href="/W2024/assets/js/14.6d793e40.js"><link rel="prefetch" href="/W2024/assets/js/15.3ef467a4.js"><link rel="prefetch" href="/W2024/assets/js/16.e42496d5.js"><link rel="prefetch" href="/W2024/assets/js/17.910bf099.js"><link rel="prefetch" href="/W2024/assets/js/18.08b50bd9.js"><link rel="prefetch" href="/W2024/assets/js/19.53a7ca32.js"><link rel="prefetch" href="/W2024/assets/js/20.3d91172a.js"><link rel="prefetch" href="/W2024/assets/js/21.6c21b589.js"><link rel="prefetch" href="/W2024/assets/js/22.be84b262.js"><link rel="prefetch" href="/W2024/assets/js/23.d04ae12b.js"><link rel="prefetch" href="/W2024/assets/js/24.7c693d08.js"><link rel="prefetch" href="/W2024/assets/js/25.19e2f70a.js"><link rel="prefetch" href="/W2024/assets/js/26.9382f0c5.js"><link rel="prefetch" href="/W2024/assets/js/27.032dbafb.js"><link rel="prefetch" href="/W2024/assets/js/28.0736d681.js"><link rel="prefetch" href="/W2024/assets/js/29.113fa4e8.js"><link rel="prefetch" href="/W2024/assets/js/3.76867010.js"><link rel="prefetch" href="/W2024/assets/js/30.e7e46473.js"><link rel="prefetch" href="/W2024/assets/js/31.d8f08733.js"><link rel="prefetch" href="/W2024/assets/js/32.a00458db.js"><link rel="prefetch" href="/W2024/assets/js/33.3f00461a.js"><link rel="prefetch" href="/W2024/assets/js/34.b9011ffd.js"><link rel="prefetch" href="/W2024/assets/js/35.b116e68e.js"><link rel="prefetch" href="/W2024/assets/js/36.500c8668.js"><link rel="prefetch" href="/W2024/assets/js/37.7104bc74.js"><link rel="prefetch" href="/W2024/assets/js/38.ae2c7ee1.js"><link rel="prefetch" href="/W2024/assets/js/39.bcaa1501.js"><link rel="prefetch" href="/W2024/assets/js/4.d88452c7.js"><link rel="prefetch" href="/W2024/assets/js/40.17750d95.js"><link rel="prefetch" href="/W2024/assets/js/41.9ca82c82.js"><link rel="prefetch" href="/W2024/assets/js/42.f38fabec.js"><link rel="prefetch" href="/W2024/assets/js/43.0e6af1f7.js"><link rel="prefetch" href="/W2024/assets/js/44.bc036991.js"><link rel="prefetch" href="/W2024/assets/js/45.2aca6234.js"><link rel="prefetch" href="/W2024/assets/js/47.41264f59.js"><link rel="prefetch" href="/W2024/assets/js/48.a7b474f8.js"><link rel="prefetch" href="/W2024/assets/js/49.d1930c68.js"><link rel="prefetch" href="/W2024/assets/js/5.ea0ea3ca.js"><link rel="prefetch" href="/W2024/assets/js/50.4f75d399.js"><link rel="prefetch" href="/W2024/assets/js/51.2e82e585.js"><link rel="prefetch" href="/W2024/assets/js/52.209d8eda.js"><link rel="prefetch" href="/W2024/assets/js/53.46795a3f.js"><link rel="prefetch" href="/W2024/assets/js/6.8a0579a1.js"><link rel="prefetch" href="/W2024/assets/js/7.015792a8.js"><link rel="prefetch" href="/W2024/assets/js/8.709a261e.js">
    <link rel="stylesheet" href="/W2024/assets/css/0.styles.38548c21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2024/" class="home-link router-link-active"><img src="/W2024/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PWA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2024/modules/react/week9/9.1/" class="sidebar-link">9.1: React Concepts</a></li><li><a href="/W2024/modules/react/week9/9.2/" class="sidebar-link">9.2: React Setup</a></li><li><a href="/W2024/modules/react/week10/10.1/" class="sidebar-link">10.1: JSX &amp; Components</a></li><li><a href="/W2024/modules/react/week10/10.2/" class="sidebar-link">10.2: Conditional Rendering, Data, and State</a></li><li><a href="/W2024/modules/react/week11/11.1/" class="sidebar-link">11.1: Synthetic Events and Props</a></li><li><a href="/W2024/modules/react/week11/11.2/" class="sidebar-link">11.2: Refs, Axios, Fetch, and Spinners</a></li><li><a href="/W2024/modules/react/week12/12.1/" class="sidebar-link">12.1: NextJS Intro</a></li><li><a href="/W2024/modules/react/week12/12.2/" class="sidebar-link">12.2: NextJS Routing</a></li><li><a href="/W2024/modules/react/week13/13.1/" aria-current="page" class="active sidebar-link">13.1: NextJS API Handling</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#nextjs-api-handling" class="sidebar-link">NextJS API Handling</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#params-and-searchparams" class="sidebar-link">params and searchParams</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#route-js-files" class="sidebar-link">route.js Files</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#server-side-redirects" class="sidebar-link">Server-Side Redirects</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#paths-for-imports" class="sidebar-link">Paths for imports</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#server-actions" class="sidebar-link">Server Actions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#suspense" class="sidebar-link">Suspense</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#middleware" class="sidebar-link">Middleware</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#context-api" class="sidebar-link">Context API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#context-and-provider-objects" class="sidebar-link">Context and Provider Objects</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#the-custom-hook" class="sidebar-link">The Custom Hook</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#localstorage-custom-hook" class="sidebar-link">LocalStorage Custom Hook</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#usereducer-hook" class="sidebar-link">useReducer Hook</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#usecallback-hook" class="sidebar-link">useCallback Hook</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#usememo-hook" class="sidebar-link">useMemo Hook</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/react/week13/13.1/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/W2024/modules/react/week13/13.2/" class="sidebar-link">13.2: Styling and Theming</a></li><li><a href="/W2024/modules/react/week14/14.1/" class="sidebar-link">14.1: TypeScript and Pair Programming</a></li><li><a href="/W2024/modules/react/week14/14.2/" class="sidebar-link">14.2: Authentication</a></li><li><a href="/W2024/modules/react/week15/" class="sidebar-link">15: React Project</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    React | NextJS
  </div> <h1>13.1 API Handling, Server Actions, and Context API</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="nextjs-api-handling"><a href="#nextjs-api-handling" class="header-anchor">#</a> NextJS API Handling</h2> <p>When building React Apps you are basically creating a SPA. With NextJS we get server-side routing for free. We are building pages, not just components inside one page.</p> <p>For each folder you have a <code>page.js</code> file. Combined with the parent <code>layout.js</code> this creates the index.html file for the current route. These pages are used on the server side to create the HTML
<strong>before</strong> it gets sent to the browser.</p> <p>You still have reusable components. Inside the <code>app</code> folder you should create a <code>components</code> folder where you can save all the reusable components. These components can be server side ones or you can
add the <code>use client</code> directive on the first line to make them into a component that will be streamed to the browser and rendered with client side JavaScript.</p> <p>Since your pages are server side script, it means that you can make the fetch calls from the server side too.</p> <p>If you consider the APIs that you are building in MAD9124, then you will remember that server side fetch calls do NOT have the <code>CORS</code> restrictions that the browsers have. They also can include API
keys because this script never gets sent to the browser. There is no security risk having your API key in the server side JS. With a client side script, including your API key does expose the key to
anyone who visits your website.</p> <p>With server side fetching, we need no state variables or hooks like <code>useEffect</code> and <code>useState</code>.</p> <p>Here is a simple example of how a page that uses fetch would be set up.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// some page.js file as an example</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://some.api.com/example</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resp<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//handle the error</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>Error message <span class="token keyword">for</span> user<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//render the content</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* This is the content for your page */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="params-and-searchparams"><a href="#params-and-searchparams" class="header-anchor">#</a> params and searchParams</h3> <p>When you have a dynamic route created by a folder name like <code>[category]</code>, the props object passed into the <code>page.js</code> file will include a property object called <code>params</code>. It will contain the value from
the URL as a property named after the folder.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// file - /[category]/.page.js</span>
<span class="token comment">// rendered from a URL of '/hello'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//destructure props to pull out params</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be {category:'hello'}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This means we can read the portion of the pathname of the url from <code>props.params</code>.</p> <p>Sometimes we also want to pass data directly to the page inside a dynamic route. Eg: <code>http://localhost:3000/hello?id=123</code> to load the <code>/[category]/page.js</code> file and give it an id param from the query
string.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// page for `http://localhost:3000/hello?id=123` is /[category]/page.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//destructure props to pull out params</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> params<span class="token punctuation">,</span> searchParams <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be {category:'hello'}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be 123</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The query string values can be used in fetch calls or other ways to create specific data.</p> <h3 id="route-js-files"><a href="#route-js-files" class="header-anchor">#</a> route.js Files</h3> <p>Another fantastic capability that we get from NextJS is the ability to create API folders that are part of our website.</p> <p>To create endpoints for your own API, just create a folder and place a <code>route.js</code> files inside the folder. The convention is to add a folder called <code>api</code> inside of the <code>app</code> folder. All your route
folders will go inside the <code>api</code> folder. These <code>route.js</code> files are known as <code>Route Handlers</code>.</p> <p>Let's say that we want to have an API with the following end points:</p> <ul><li><code>https://localhost:3000/api/cats</code></li> <li><code>https://localhost:3000/api/dogs</code></li></ul> <p>It will have the following directory structure:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- app
  - api
    - cats
      - route.js
    - dogs
      - route.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Inside each of the <code>route.js</code> files, you can create an exported function named for each HTTP Verb.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/api/cats/route.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cookies<span class="token punctuation">,</span> headers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/headers'</span><span class="token punctuation">;</span>
<span class="token comment">//import cookies to be able to access, set and get cookie values</span>
<span class="token comment">//import headers to directly access the headers</span>
<span class="token comment">// inside any function you can do something like this:</span>
<span class="token comment">//const cookieStore = cookies()</span>
<span class="token comment">//const token = cookieStore.get('token')</span>
<span class="token comment">//const headersList = headers()</span>
<span class="token comment">//const referer = headersList.get('referer')</span>
<span class="token comment">//both these can also be accessed from the request object</span>


<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//each method function will get passed the request object</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//each method should return a response object</span>
  <span class="token comment">//we can do a fetch call to another api from here</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'some other api url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'API-Key'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATA_API_KEY</span><span class="token punctuation">,</span>
      <span class="token comment">//read a value from environment variables for the api key</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span>
    <span class="token comment">//we can set the results as valid for 60 seconds</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'contents of response'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//each method function will get passed the request object</span>
  <span class="token comment">//function can be async if you plan to do something asynchronous</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//we can do fetch calls from here too</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'some other api url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'API-Key'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATA_API_KEY</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Steve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resp<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'{&quot;code&quot;:444, &quot;message&quot;:&quot;fail&quot;}'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">444</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//extract the json data from the fetch</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//convert or select whatever part you want then return it</span>
  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">PATCH</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">PUT</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">DELETE</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">HEAD</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">OPTIONS</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>You can create a function for any HTTP methods you need. They can return any type of response you need. They can return JSON, HTML, XML, text, or even images.</p> <p>Since this code is all running on the server side, it means that we can also access <strong>Environment variables</strong> from the server. Notice inside the <code>fetch</code> call in the <code>POST</code> function there is a header
that uses <code>process.env.DATA_API_KEY</code> as its value.</p> <p>In NodeJS you can use <code>process.env</code> to access any and all environment variables on the server.</p> <p>If you are using Vercel or Netlify, then part of the configuration for any project will include creating environment variables to hold things like API keys.</p> <p>Additionally, all the fetch call results will automatically be cached. Inside the <code>fetch()</code> options object we can add a property called <code>next</code> whose value will be an object with a <code>revalidate</code>
property that holds a number of seconds. This is the length of time to hold the fetch results in the cache, to save processing time and bandwidth.</p> <h3 id="server-side-redirects"><a href="#server-side-redirects" class="header-anchor">#</a> Server-Side Redirects</h3> <p>If you ever want to do a redirect on the server-side to a different URL then you can import and use the <code>redirect</code> method like the following.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'https://nextjs.org/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="paths-for-imports"><a href="#paths-for-imports" class="header-anchor">#</a> Paths for imports</h3> <p>When creating your components or pages, the paths to your imports are relative. They will be different depending on which file is doing the importing.</p> <p>NextJS has a great solution to simplify your imports.</p> <p>With the following directory structure, let's say we are building the <code>page.js</code> file inside the <code>/app/[category]/product/</code> folder.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- app
  - components
    - Header.js
  - [category]
    - page.js
    - product
      - page.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The standard way for <code>product/page.js</code> to import the <code>Header.js</code> component would be:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'../../components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If <code>[category]/page.js</code> were importing the same file, then the import would be:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'../components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As your application becomes more complex, the calculating of imports can be a bit more difficult too. To address this, we have a different import syntax for NextJS that we can use.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'@/app/components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>@/app</code> is a direct pointer to the app folder from anywhere in the directory structure.</p> <p>You can build your own custom import shortcuts by editing the <code>jsconfig.json</code> file.</p> <h2 id="server-actions"><a href="#server-actions" class="header-anchor">#</a> Server Actions</h2> <p>Server Actions are an alternative to route handlers. They let you embed a function for handling form submissions inside the same server-side component or page as the form.</p> <p>First, in your <code>&lt;form&gt;</code> you will use an <code>action</code> attribute instead of an <code>onSubmit</code> attribute. The value of the <code>action</code> will be the name of the function inside the page function that contains the
form.</p> <p>When the <code>handleSubmit</code> server-side function is called, it means that NextJS has bundled everything in your Form as a FormData object and sent it to the server. The FormData object will be extracted
from the Request object and passed to your server-side <code>Server Action</code> function.</p> <p>You MUST add the <code>use server</code> directive as the first line inside your function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /something/page.js</span>
<span class="token keyword">import</span> MySubmitButton <span class="token keyword">from</span> <span class="token string">'@/app/components/MySubmitButton'</span><span class="token punctuation">;</span> <span class="token comment">//a client side component</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use server'</span><span class="token punctuation">;</span>
    <span class="token comment">//await fetch or whatever async thing you want</span>
    <span class="token comment">//then tell the current route to update itself</span>
    <span class="token function">revalidatePath</span><span class="token punctuation">(</span><span class="token string">'/something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;Your name&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>MySubmitButton <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>And the submit button client-side component can use the <code>useFormStatus</code> hook to determine the current status of the <code>&lt;form&gt;</code>. This is waiting for the form data to be sent to the server and a response
back from the server.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useFormStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">SubmitButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pending <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFormStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>pending<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;disabled:bg-zinc-500&quot;</span><span class="token operator">&gt;</span>
      Click Me
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>With the <code>disabled</code> attribute in the button using the <code>pending</code> value, it will be set as disabled after the first time the user clicks the button. It will not get re-enabled until the result is
streamed back from the server.</p> <p>Any time you have a simple async task to complete on the server, <code>Server Actions</code> are a quick and easy way to handle this.</p> <p>Another way that you can manage your server actions is to create a single file at the root called <code>actions.js</code>. Place all your server action functions inside this file and have the <code>use server</code>
directive at the top of the file. With the file marked as a server side script you can import any of the functions into your client components elsewhere in your app.</p> <p>Here is an example of an actions.js file with a couple server action functions. <strong>Remember that action functions must be async.</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/actions.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> revalidatePath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/cache'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">zeroOne</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//return 0 or 1</span>
  <span class="token comment">//save the value somewhere that can be retrieved when page.js runs again</span>
  <span class="token comment">//then call revalidatePath or redirect</span>
  <span class="token function">revalidatePath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitZeroOne</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//return 0 or 1 after a 2 second delay</span>
  <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//save the value somewhere that can be retrieved when page.js runs again</span>
  <span class="token comment">// revalidatePath(`/${something}`);</span>
  <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>The server action functions can call <code>revalidatePath()</code> from <code>'next/cache'</code> or <code>redirect()</code> from <code>'next/navigation'</code> to effectively reload the <code>page.js</code> that triggered the action.</p> <p>Then we import those functions in our client side component with event handling.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/components/MyButton.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> waitZeroOne <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/app/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyButton</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">waitZeroOne</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The client side button component needs to be used in a page, of course.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/[something]/page.js</span>

<span class="token keyword">import</span> MyButton <span class="token keyword">from</span> <span class="token string">'@/app/components/MyButton'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> searchParams <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> something <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
  <span class="token keyword">const</span> num <span class="token operator">=</span> searchParams<span class="token punctuation">.</span>num<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>Page <span class="token punctuation">{</span>something<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>num <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>The number is <span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>MyButton page<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The path part of the url is passed to the button through props. The button calls the server action. Then the server action function has to call revalidate so the generated value can be passed back to
the page. In this example, the pathname is passed to the server action function.</p> <p>Here is a <a href="https://github.com/prof3ssorSt3v3/bookish-waddle" target="_blank" rel="noopener noreferrer">repo with a demo of the Server Actions tied to a form<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It takes two values from a form and uses one for the folder name and the second as
a querystring value.</p> <h3 id="suspense"><a href="#suspense" class="header-anchor">#</a> Suspense</h3> <p>The <code>&lt;Suspense fallback=&quot;&quot;&gt;</code> component that we discussed in React, works well with NextJS too.</p> <p>In this following example, there is a dynamic component that will be making a fetch call using an async component function. We want the rest of the page to appear in the browser before the fetch
completes. When completed, we want the contents of the dynamic component to be streamed to the browser and replace the <code>&lt;Suspense&gt;</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app/page.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>Suspense<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TheDynamicDataComponent <span class="token keyword">from</span> <span class="token string">'@/app/components/TheDynamicDataComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Static Masthead content<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>section<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token string">'&lt;p&gt;Loading...&lt;/p&gt;'</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>TheDynamicDataComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Static footer content<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>And here is an example of a the <code>TheDynamicDataComponent</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/components/TheDynamicDataComponent.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">TheDynamicDataComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Note the async</span>
  <span class="token comment">//fake a fetch call</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//wait 3 seconds before continuing</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>This is the dynamic data that took <span class="token number">3</span> seconds to build<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h2> <p>When you build APIs with NodeJS and Express, you are frequently using middleware. These are functions that run as part of a sequence that starts when the HTTP request arrives at the server and
finishes with the server sending the response back to the browser.</p> <p>NextJS also has middleware. These are functions that can run before your <code>page.js</code>.</p> <p>They are most commonly used when you need to do something like validate a user before sending a response. You can use the middleware to do anything you want though. To create the middleware, simply
add a file called <code>middleware.js</code> inside your <code>app</code> folder and give it a function named <code>middleware</code> and a variable called <code>config</code>.</p> <p>The <code>middleware</code> function will automatically be called (convention over configuration). It will be passed the request object.</p> <p>The <code>config</code> variable needs to contain an object with a property called <code>matcher</code>. The <code>matcher</code> property will hold an array with a list of routes to match. For each of these routes, the <code>middleware</code>
function will be called before your <code>page.js</code>.</p> <p>The request parameter passed to the <code>middleware</code> function will be a <code>NextRequest</code> object. You need to import the <code>NextRequest</code> and <code>NextResponse</code> objects from <code>next/server</code>. The <code>middleware</code> function
needs to return a call <code>NextResponse.next()</code>, which will trigger the next step in the process of layout.js -&gt; page.js -&gt; components, etc. that ends with sending the response to the browser.</p> <p>Inside your <code>middleware</code> function you will be able to do server-side redirects to other pages if you want. Just use the <code>NextResponse.redirect()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse<span class="token punctuation">,</span> NextRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">matcher</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/dashboard'</span><span class="token punctuation">,</span> <span class="token string">'/account'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div> <h2 id="context-api"><a href="#context-api" class="header-anchor">#</a> Context API</h2> <p>React <a href="https://react.dev/learn/passing-data-deeply-with-context" target="_blank" rel="noopener noreferrer">Context API reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The Context API is one way that you can manage global state data within your React Application.</p> <p>The Context API is designed to work on the client side when managing state values in a single page application.</p> <p>We have already covered how you can create <code>state</code> variables in every component and how you can pass those values down from a parent to a child through <code>props</code>. We can create a state variable in the
<code>App</code> component and then pass it down through <code>props</code> to every other component in the web app. We can also pass down the <code>set</code> function for the <code>App</code>'s state variable through <code>props</code>.</p> <p>There is nothing stopping any developer from passing everything through <code>props</code>. However, it does make for a lot more code and therefore more difficult maintenance, plus wasted memory by passing all
the values and objects from the top.</p> <p>Instead, with <code>Context</code> we can create a global object that has a <code>useContext</code> hook which can be called directly from any component that needs access to the information.</p> <div class="custom-block danger"><p class="custom-block-title">Context</p> <p>Context is not a replacement for your state variables inside components. It is meant to aid the few things that you will actually need in multiple components in different areas of your app.</p></div> <p>If you have settings like a user's name and whether or not they are logged in. This would be perfect for storage inside a Context object.</p> <p>If you have a large dataset that will have multiple components that display part of the data and other components that need to edit parts of that data, then Context would be useful too.</p> <h3 id="context-and-provider-objects"><a href="#context-and-provider-objects" class="header-anchor">#</a> Context and Provider Objects</h3> <p>The way the Context API gets used is by having a global <code>Context</code> Object, which will have a <code>Provider</code> property. The <code>Provider</code> is the part that gets wrapped around your whole app, in the same way
that the <code>BrowserRouter</code> component gets wrapped around the whole app.</p> <p>Whereever you place the <code>Provider</code> is the highest level that the data can be accessed. Typically this is done in the <code>&lt;App&gt;</code> component. The Provider is a function that gets called to load, change, or
access the data stored in the Content object.</p> <p>Let's create a basic Context object that will hold a username so that it can be accessed from anywhere in the app. Start by creating a file to hold the context object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//UserContext.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//create the context object</span>

<span class="token keyword">function</span> <span class="token function">UserProvider</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//create the provider object</span>
  <span class="token comment">//it has a props object just like all component functions</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//state variable to hold the username</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token comment">//create and return a Context-Provider component.</span>
  <span class="token comment">//it must have a value property which holds the state variable and a function</span>
  <span class="token comment">//the function is usually the set function returned by useState...but can be another</span>
  <span class="token comment">//{...props} destructuring adds any other props passed into the provider</span>
  <span class="token comment">//These props will include ALL the components nested inside the Provider (children)!</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//create a custom hook that can be called from components</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//we use the built-in useContext hook to access our own Context object.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Not inside the Provider'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> context<span class="token punctuation">;</span> <span class="token comment">// [username, setUsername]</span>
  <span class="token comment">//we are returning our own state variable and function from UserContext Provider</span>
<span class="token punctuation">}</span>

<span class="token comment">//export the hook and the provider</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> useUser<span class="token punctuation">,</span> UserProvider <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>We are exporting the hook <code>useUser</code> that will be used in various Components to access the data held inside the Context Object. We are exporting the Context Provider <code>UserProvider</code> to be the wrapper
around the part of the app that needs to access the Context data.</p> <p>The <code>UserProvider</code> export gives us a <code>&lt;UserProvider&gt;&lt;/UserProvider&gt;</code> component that will wrap other components. The return statement for the Provider function includes this <code>{...props}</code> which will
contain ALL the nested children components inside <code>&lt;UserProvider&gt;</code>.</p> <div class="custom-block tip"><p class="custom-block-title">props.children</p> <p>Inside every props object passed to a component will be the actual contents that were written in the JSX.
<a href="https://react.dev/learn/passing-props-to-a-component#passing-jsx-as-children" target="_blank" rel="noopener noreferrer">Learn more about props.children<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. More about this later.</p></div> <p>This <code>UserContext.js</code> file is normally put inside a folder called <code>/src/context/</code>. It will be imported at the root level where we want our data (for the UserProvider) and then again in any component
file (for the hook) where we want to access the username.</p> <p>Assuming that we want the Context Provider to wrap all the components that are inside our <code>&lt;App&gt;</code> component, will will import <code>UserProvider</code> there.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//App.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserProvider<span class="token punctuation">,</span> useUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../context/UserContext.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./Header.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Main <span class="token keyword">from</span> <span class="token string">'./Main.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Footer <span class="token keyword">from</span> <span class="token string">'./Footer.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//because we are setting the value of username in the context object</span>
  <span class="token comment">//from here, we need to import the useUser hook too.</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//this runs on initial load of &lt;App&gt;</span>
    <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">'Steve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//we will just hardcode a value to use for username</span>
    <span class="token comment">//for simplicity's sake</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>UserProvider<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>username <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello <span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Main <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Footer <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserProvider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>The <code>&lt;UserProvider&gt;</code> element that we wrote above here will be converted into <code>&lt;UserContext.Provider value={[username, setUsername]} {...props} /&gt;</code>. Then the <code>{...props}</code> will be replaced with any
props plus all the child components that were written inside of <code>&lt;UserProvider&gt;</code>.</p> <p>We <strong>ARE</strong> allowed to import and use more than one Context Provider in our web apps.</p> <h3 id="the-custom-hook"><a href="#the-custom-hook" class="header-anchor">#</a> The Custom Hook</h3> <p>Once we have a Context Provider and custom hook defined in <code>UserContext.js</code>, and the <code>&lt;UserProvider&gt;</code> wrapping other components in <code>App.js</code>, then we can start giving any nested component access to the
data.</p> <p>We do NOT need to start putting props that hold data in our components to pass down to the children components.</p> <p>If you want to set a value for the state variable which is inside of the Context object, then you need to import your <code>useUser</code> custom hook.</p> <p>The custom hook acts a lot like <code>useState</code>. It returns a reference to the value from Context AND a function to use in updating that value.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../context/UserContext.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setUser</span><span class="token punctuation">(</span><span class="token string">'some new value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//you will have set the initial default value inside the Context Provider function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>In any Component JavaScript file you can import the custom hook to gain access to the value and the function to change the value.</p> <div title="Context API and Hooks" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/XwrcHzVk6es" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>Sometimes the provider(s) will be placed inside the index.jsx / main.jsx at the root, instead of the <code>App.jsx</code>. As long as the provider is above all the components that will need access to the data
that the provider controls.</p> <h2 id="localstorage-custom-hook"><a href="#localstorage-custom-hook" class="header-anchor">#</a> LocalStorage Custom Hook</h2> <p>LocalStorage is a good example of something that is read once and written to many times. LocalStorage can be used with Context. LocalStorage can be wrapped inside a custom hook that we build
ourselves.</p> <p>The data that is saved in LocalStorage and used in a web app should have a single source of truth. You need to have a single variable that is used by the running application. This is the single source
of truth.</p> <p>When the data needs to be updated, you update that one variable.</p> <p>When you need to display the data, you get it from the one variable.</p> <p>After updating the variable, you update the backup data in LocalStorage.</p> <p>When the app loads initially, you read from LocalStorage to set the initial value in the variable.</p> <p>We can create a custom hook for dealing with LocalStorage, which can be accessed from anywhere in the app. It will do the initial read to get the data out of LocalStorage. It will also be responsible
for updating the backup version of the data from the variable.</p> <p>If you wanted to get the initial data from a remote source you could use <code>fetch</code> or <code>axios</code> to retrieve the data and set it as the initial value in LocalStorage AND in the variable.</p> <p>Here is a sample custom hook that we can use to manage values in LocalStorage.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//when calling our custom hook we pass in a key and an initial value.</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> storedValue <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> storedValue <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storedValue<span class="token punctuation">)</span> <span class="token operator">:</span> initialState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>state<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//each time useLocalStorageState is called it will return a reference</span>
  <span class="token comment">// to the state variable and the function to update the value</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div title="Custom Hooks, LocalStorage, and Axios" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/qzi-X3quu3w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="usereducer-hook"><a href="#usereducer-hook" class="header-anchor">#</a> useReducer Hook</h2> <p>The <code>useReducer</code> hook is an alternative to the <code>useState</code> hook. It is useful when you are using some type of state management system to update your state values. This is only necessary when you have
complex state objects and want to control many different scenarios that could happen to your state values.</p> <p>Here is a short video about the concept of a reducer.</p> <div title="what is a reducer" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/TOhUqDGNFtA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>And here is the signature of the <code>useReducer</code> hook. It accepts a reducer function that does something like this: <code>(state, action) =&gt; newState</code>. The useReducer hook will return an array with the
current state object plus a method to call when you want to update your state object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>initialArg</code> is the initial value for your state object.</p> <p>Here is an example that shows building a Counter Component and the reducer function knows that it is supposed to add or deduct one from the state.count property based on the value of the <code>type</code>
property passed to the <code>dispatch</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="usecallback-hook"><a href="#usecallback-hook" class="header-anchor">#</a> useCallback Hook</h2> <p>The <code>useCallback</code> hook lets you create a memoized version of your callback function with dependencies.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the function call that gets memoized</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token comment">//the dependencies mapped to the function</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>A new memoized version of the <strong>callback function</strong> is created if those dependencies change.</p> <h2 id="usememo-hook"><a href="#usememo-hook" class="header-anchor">#</a> useMemo Hook</h2> <p>Let's you <code>memoize</code> a function's return value based on the parameters that are passed to it. Memoizing relies on <code>pure</code> functions - a function that always returns the same output when given the same
input. If you have to call a function repeatedly with the same small set of values then you should consider saving the results in an object where the different input values are the keys and the output
values are the key values.</p> <p>Here is a short video about the concept of Memoization.</p> <div title="memoization" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/_1drYP7Zm_Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>And here is a sample demonstration of the useMemo hook in action.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//call this function and remember the result</span>
  <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//this is an array of dependencies to watch</span>
<span class="token comment">//the dependencies are the values being passed into the function.</span>
<span class="token comment">//use as many params as you need for your function.</span>
<span class="token comment">//the returned value will be remembered as a result of that combination of params.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The <code>useMemo</code> hook runs during rendering. So, if you need to call a function with a side-effect then use the <code>useEffect</code> hook.</p> <p>The purpose of this hook is to improve performance when a function is computationally expensive. It is <strong>NOT</strong> to be used on all your functions.</p> <h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO Things to do before next week.</p> <ul><li>Read all the content from <code>Modules 13.1, 13.2, and 14.1</code>.</li> <li>Keep watching the <a href="https://www.youtube.com/watch?v=IkkzjbdIOBM&amp;list=PLyuRouwmQCjmMfs-HOsDGoaN6JiYrC6Ms" target="_blank" rel="noopener noreferrer">React in 2021 Video Tutorial Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/9/2024, 8:56:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2024/modules/react/week12/12.2/" class="prev">
        12.2: NextJS Routing
      </a></span> <span class="next"><a href="/W2024/modules/react/week13/13.2/">
        13.2: Styling and Theming
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/W2024/assets/js/app.75ab4a46.js" defer></script><script src="/W2024/assets/js/2.169fe304.js" defer></script><script src="/W2024/assets/js/46.51e42aff.js" defer></script><script src="/W2024/assets/js/9.83ac2bbe.js" defer></script><script src="/W2024/assets/js/11.5fe5a40b.js" defer></script>
  </body>
</html>
